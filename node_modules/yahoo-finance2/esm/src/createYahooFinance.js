import defaultOptions from "./lib/options.js";
import yahooFinanceFetch from "./lib/yahooFinanceFetch.js";
import moduleExec from "./lib/moduleExec.js";
class YahooFinance {
    constructor(options) {
        Object.defineProperty(this, "_opts", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "_fetch", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        Object.defineProperty(this, "_moduleExec", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        // XXX TODO remove
        Object.defineProperty(this, "_env", {
            enumerable: true,
            configurable: true,
            writable: true,
            value: void 0
        });
        /// XXX TODO mergeoptions from setGlobalConfig
        this._opts = { ...defaultOptions, ...options };
        this._fetch = yahooFinanceFetch;
        this._moduleExec = moduleExec;
        // XXX TODO remove
        this._env = {
            URLSearchParams,
            fetch,
            async fetchDevel() {
                const { default: fetchCache } = await import("../tests/fetchCache.js");
                function fetchDevel(input, init) {
                    // @ts-expect-error: later
                    const { devel, ..._init } = init || {};
                    // console.log({ devel });
                    if (typeof devel === "string") {
                        fetchCache._once({ id: devel.replace(/\.json$/, "") });
                    }
                    else {
                        throw new Error("unexpected fetchDevel value: " + JSON.stringify(devel));
                    }
                    return fetch(input, init);
                }
                return fetchDevel;
            },
        };
    }
}
export default function createYahooFinance(createOpts) {
    Object.assign(YahooFinance.prototype, createOpts.modules);
    return YahooFinance;
}
